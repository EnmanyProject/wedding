<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>스와이프 시스템 종합 테스트</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            margin: 0;
            padding: 10px;
            min-height: 100vh;
            font-size: 14px;
        }

        .test-container {
            max-width: 100%;
            width: 100%;
            margin: 0 auto;
            background: white;
            padding: 15px;
            border-radius: 20px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.1);
            backdrop-filter: blur(10px);
        }

        h1 {
            text-align: center;
            color: #333;
            margin: 10px 0 20px 0;
            font-size: 20px;
            font-weight: 600;
        }

        h2 {
            font-size: 16px;
            color: #555;
            margin: 10px 0;
            border-bottom: 2px solid #f0f0f0;
            padding-bottom: 8px;
        }

        .test-section {
            margin: 15px 0;
            padding: 12px;
            border: 1px solid #e9ecef;
            border-radius: 15px;
            background: #fafafa;
        }

        .test-button {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 12px 16px;
            border-radius: 25px;
            cursor: pointer;
            margin: 5px 3px;
            font-size: 14px;
            font-weight: 500;
            width: calc(50% - 6px);
            display: inline-block;
            text-align: center;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
        }

        .test-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(102, 126, 234, 0.6);
        }

        .test-button:active {
            transform: translateY(0);
        }

        .test-button.full-width {
            width: calc(100% - 6px);
        }

        .log-area {
            background: #1a1a1a;
            color: #00ff00;
            border: 1px solid #333;
            border-radius: 15px;
            padding: 12px;
            max-height: 300px;
            overflow-y: auto;
            font-family: 'Courier New', monospace;
            font-size: 11px;
            white-space: pre-wrap;
            line-height: 1.4;
        }

        .status {
            padding: 8px 12px;
            border-radius: 15px;
            margin: 8px 0;
            font-size: 13px;
            font-weight: 500;
        }

        .status.success {
            background: linear-gradient(135deg, #4CAF50 0%, #45a049 100%);
            color: white;
        }

        .status.error {
            background: linear-gradient(135deg, #f44336 0%, #d32f2f 100%);
            color: white;
        }

        .status.warning {
            background: linear-gradient(135deg, #ff9800 0%, #f57c00 100%);
            color: white;
        }

        .status.info {
            background: linear-gradient(135deg, #2196F3 0%, #1976D2 100%);
            color: white;
        }

        /* 모바일 반응형 */
        @media (max-width: 480px) {
            body {
                padding: 5px;
                font-size: 13px;
            }

            .test-container {
                padding: 10px;
                border-radius: 15px;
            }

            h1 {
                font-size: 18px;
            }

            h2 {
                font-size: 15px;
            }

            .test-button {
                width: 100%;
                margin: 3px 0;
                padding: 14px 16px;
                font-size: 13px;
            }

            .log-area {
                max-height: 250px;
                font-size: 10px;
            }
        }

        /* 세로 모드 최적화 */
        @media (orientation: portrait) {
            .test-button {
                width: 100%;
                margin: 5px 0;
            }
        }

        /* 가로 모드 최적화 */
        @media (orientation: landscape) and (max-height: 600px) {
            .test-section {
                margin: 10px 0;
                padding: 8px;
            }

            .log-area {
                max-height: 200px;
            }
        }

        /* 스크롤바 스타일링 */
        .log-area::-webkit-scrollbar {
            width: 6px;
        }

        .log-area::-webkit-scrollbar-track {
            background: #2a2a2a;
            border-radius: 3px;
        }

        .log-area::-webkit-scrollbar-thumb {
            background: #00ff00;
            border-radius: 3px;
        }

        .log-area::-webkit-scrollbar-thumb:hover {
            background: #00cc00;
        }
    </style>
</head>
<body>
    <div class="test-container">
        <h1>🔧 스와이프 시스템 종합 진단</h1>

        <div class="test-section">
            <h2>1. 시스템 상태 확인</h2>
            <button class="test-button" id="check-system-btn">시스템 상태 확인</button>
            <div id="system-status"></div>
        </div>

        <div class="test-section">
            <h2>2. DOM 요소 검증</h2>
            <button class="test-button" id="check-dom-btn">DOM 요소 확인</button>
            <div id="dom-status"></div>
        </div>

        <div class="test-section">
            <h2>3. 메인 앱 연결</h2>
            <button class="test-button" id="open-app-btn">메인 앱 열기</button>
            <button class="test-button" id="load-frame-btn">프레임으로 로드</button>
            <div id="app-frame-container" style="margin-top: 10px;"></div>
        </div>

        <div class="test-section">
            <h2>4. 자동 스와이프 테스트</h2>
            <button class="test-button" id="swipe-test-btn">📱 스와이프 테스트</button>
            <button class="test-button" id="button-test-btn">🔘 버튼 테스트</button>
            <button class="test-button full-width" id="comprehensive-test-btn">🚀 종합 테스트 실행</button>
        </div>

        <div class="test-section">
            <h2>📊 테스트 로그</h2>
            <button class="test-button full-width" id="clear-log-btn">🗑️ 로그 지우기</button>
            <div id="test-log" class="log-area">테스트 준비 완료. 위의 버튼들을 클릭하여 진단을 시작하세요.\n</div>
        </div>
    </div>

    <script>
        function log(message, type = 'info') {
            const logArea = document.getElementById('test-log');
            const timestamp = new Date().toLocaleTimeString();
            const logEntry = `[${timestamp}] ${message}\n`;
            logArea.textContent += logEntry;
            logArea.scrollTop = logArea.scrollHeight;

            console.log(message);
        }

        function setStatus(elementId, message, type) {
            const element = document.getElementById(elementId);
            element.innerHTML = `<div class="status ${type}">${message}</div>`;
        }

        function checkSystemStatus() {
            log('🔍 시스템 상태 확인 시작...');

            try {
                // 현재 페이지에서 확인
                const hasUIInstance = typeof window.ui !== 'undefined';
                const hasUIManager = typeof UIManager !== 'undefined';

                log(`- UI 인스턴스 존재: ${hasUIInstance}`);
                log(`- UIManager 클래스 존재: ${hasUIManager}`);

                if (hasUIInstance) {
                    log(`- 파트너 스와이퍼 초기화: ${window.ui.partnerSwiperInitialized || false}`);
                    log(`- 현재 파트너 인덱스: ${window.ui.currentPartnerIndex || 0}`);
                    log(`- 파트너 배열 길이: ${window.ui.currentPartners?.length || 0}`);
                    setStatus('system-status', '✅ UI 시스템이 로드되어 있습니다', 'success');
                } else {
                    setStatus('system-status', '⚠️ UI 시스템이 로드되지 않았습니다. 메인 앱에서 확인 필요', 'warning');
                }

            } catch (error) {
                log(`❌ 시스템 상태 확인 오류: ${error.message}`);
                setStatus('system-status', `❌ 오류: ${error.message}`, 'error');
            }
        }

        function checkDOMElements() {
            log('🔍 DOM 요소 확인 시작...');

            const elements = [
                'mobile-partner-swiper',
                'partner-cards-container',
                'prev-partner-btn',
                'next-partner-btn'
            ];

            let foundCount = 0;
            elements.forEach(id => {
                const element = document.getElementById(id);
                const exists = element !== null;
                log(`- #${id}: ${exists ? '✅ 존재' : '❌ 없음'}`);
                if (exists) foundCount++;
            });

            if (foundCount === elements.length) {
                setStatus('dom-status', '✅ 모든 필수 DOM 요소가 존재합니다', 'success');
            } else {
                setStatus('dom-status', `⚠️ ${foundCount}/${elements.length} 요소만 발견됨. 메인 앱에서 확인 필요`, 'warning');
            }
        }

        function openMainApp() {
            log('🚀 메인 앱 새 창으로 열기...');
            window.open('http://localhost:3000', '_blank');
        }

        function loadMainAppFrame() {
            log('🚀 메인 앱 프레임으로 로드...');
            const container = document.getElementById('app-frame-container');
            container.innerHTML = '<iframe src="http://localhost:3000" width="100%" height="600" style="border: 1px solid #ccc; border-radius: 5px;"></iframe>';
        }

        function runSwipeTest() {
            log('📱 스와이프 테스트 실행...');

            // 메인 앱에서 실행될 스크립트 생성
            const testScript = `
                // 스와이프 시스템 테스트
                console.log('🧪 [Test] 스와이프 테스트 시작');

                if (window.ui) {
                    console.log('✅ UI 인스턴스 발견');
                    console.log('현재 인덱스:', window.ui.currentPartnerIndex);

                    // 수동 네비게이션 테스트
                    window.ui.navigatePartnerCard('next');

                    setTimeout(() => {
                        console.log('이동 후 인덱스:', window.ui.currentPartnerIndex);
                        window.ui.navigatePartnerCard('prev');
                    }, 1000);
                } else {
                    console.error('❌ UI 인스턴스 없음');
                }
            `;

            log('스크립트를 메인 앱 콘솔에서 실행하세요:');
            log(testScript);
        }

        function runButtonTest() {
            log('🔘 버튼 테스트 실행...');

            const testScript = `
                // 버튼 클릭 테스트
                const prevBtn = document.getElementById('prev-partner-btn');
                const nextBtn = document.getElementById('next-partner-btn');

                console.log('이전 버튼:', prevBtn);
                console.log('다음 버튼:', nextBtn);

                if (nextBtn) {
                    console.log('다음 버튼 클릭...');
                    nextBtn.click();

                    setTimeout(() => {
                        if (prevBtn) {
                            console.log('이전 버튼 클릭...');
                            prevBtn.click();
                        }
                    }, 1000);
                } else {
                    console.error('버튼을 찾을 수 없습니다');
                }
            `;

            log('스크립트를 메인 앱 콘솔에서 실행하세요:');
            log(testScript);
        }

        function runComprehensiveTest() {
            log('🔍 종합 테스트 실행...');

            const comprehensiveScript = `
                console.log('=== 종합 스와이프 시스템 진단 ===');

                // 1. 시스템 상태
                console.log('1. 시스템 상태:');
                console.log('- window.ui:', window.ui);
                console.log('- 초기화 상태:', window.ui?.partnerSwiperInitialized);

                // 2. DOM 요소
                console.log('2. DOM 요소:');
                const swiper = document.getElementById('mobile-partner-swiper');
                const container = document.getElementById('partner-cards-container');
                const prevBtn = document.getElementById('prev-partner-btn');
                const nextBtn = document.getElementById('next-partner-btn');

                console.log('- 스와이퍼:', swiper);
                console.log('- 컨테이너:', container);
                console.log('- 이전 버튼:', prevBtn);
                console.log('- 다음 버튼:', nextBtn);

                // 3. 카드 정보
                if (container) {
                    const cards = container.querySelectorAll('.partner-card');
                    console.log('3. 카드 정보:');
                    console.log('- 카드 개수:', cards.length);
                    console.log('- 컨테이너 크기:', container.offsetWidth);
                    console.log('- 스와이퍼 크기:', swiper?.offsetWidth);
                }

                // 4. 자동 테스트 실행
                if (window.ui && nextBtn) {
                    console.log('4. 자동 테스트:');
                    console.log('다음 버튼 클릭...');
                    nextBtn.click();

                    setTimeout(() => {
                        console.log('이전 버튼 클릭...');
                        prevBtn?.click();
                    }, 1500);
                }

                console.log('=== 진단 완료 ===');
            `;

            log('종합 테스트 스크립트:');
            log(comprehensiveScript);
            log('\n📋 실행 방법:');
            log('1. 메인 앱 창을 엽니다 (위의 "메인 앱 열기" 버튼 클릭)');
            log('2. F12로 개발자 도구를 엽니다');
            log('3. Console 탭을 선택합니다');
            log('4. 위의 스크립트를 복사하여 붙여넣고 실행합니다');
        }

        function clearLog() {
            document.getElementById('test-log').textContent = '로그가 지워졌습니다.\n';
        }

        // 페이지 로드 시 자동 실행
        window.addEventListener('load', () => {
            log('🔧 스와이프 시스템 진단 도구 준비 완료');
            log('📋 사용법: 위의 버튼들을 순서대로 클릭하여 진단하세요');

            // 이벤트 리스너 등록
            document.getElementById('check-system-btn').addEventListener('click', checkSystemStatus);
            document.getElementById('check-dom-btn').addEventListener('click', checkDOMElements);
            document.getElementById('open-app-btn').addEventListener('click', openMainApp);
            document.getElementById('load-frame-btn').addEventListener('click', loadMainAppFrame);
            document.getElementById('swipe-test-btn').addEventListener('click', runSwipeTest);
            document.getElementById('button-test-btn').addEventListener('click', runButtonTest);
            document.getElementById('comprehensive-test-btn').addEventListener('click', runComprehensiveTest);
            document.getElementById('clear-log-btn').addEventListener('click', clearLog);

            log('✅ 모든 버튼 이벤트 리스너 등록 완료');
        });
    </script>
</body>
</html>